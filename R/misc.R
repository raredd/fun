### miscellaneous stuff
# sparkbar, R, collatz, trace_path, bubble_sort, fibonnaci, golden, is.happy
###

#' SparkBar generator
#' 
#' Generates a sparkbar from a sequence of numbers.
#' 
#' @aliases
#' sparkbar, spark
#' 
#' @param ... numerics
#' @seealso \url{https://gist.github.com/ramnathv/7793167}
#' 
#' @examples
#' spark(30, 31, 32, 33)
#' spark(runif(20))
#' 
#' @export

spark <- function(...) {
  
  nums <- c(...)
  min_value <- min(nums)
  max_value <- max(nums)
  value_scale <- max_value - min_value
  zzz <- NULL
  
  for (number in nums) {
    if ((number - min_value) != 0 && (value_scale != 0)) {
      scaled_value <- (number - min_value) / value_scale
    } else {
      scaled_value <- 0
    }
    ## hack:
    ## 9604 and 9608 aren't vertically aligned 
    ## the same as other block elements
    num <- floor(min(6, scaled_value * 7))
    if (num == 3) {
      num <- ifelse ((scaled_value * 7) < 3.5, 2, 4)
    } else if (num == 7) {
      num <- 6
    }
    zzz <- c(zzz, num)
  }
  noquote(intToUtf8(9601 + zzz))
}

#' r
#' 
#' \code{R}
#' 
#' @usage R()
#' 
#' @export

R <- function() {
  eval(quote({h=character;r=rep;a=b=h(0);p=options()$width%/%2-5;n="
              ";j=r(toupper(substring(mode(a),4,4)),sum(r(5:9,2)+1)-3)
              k=r(5:9,2);k[4:5]=7;k=cumsum(k+1);j[k]=n;m=paste(h(1),h(1
              ));s=c(0,k[-10])+1;j[c(16:17,24:26,32:33,46:47,53:55,61:64
              ,70:74)]=m;for(i in 1:10)a=c(a,r(m,p),j[s[i]:k[i]])
              cat(c(n,a),sep=b)}))
}

#' Collatz conjecture
#' 
#' Perform and visualize the Collatz conjecture.
#' 
#' @param n starting number (integer)
#' @param stoptime logical; if \code{FALSE} (default), the value at each
#' iteration is plotted with a summary of the values; if \code{TRUE}, instead,
#' the first \code{n} stopping times are plotted along with the OEIS sequence
#' of numbers \code{<= n}, that is, from one to \code{n}, the number of 
#' iterations each starting value takes to reach 1
#' 
#' @references 
#' \url{http://imgs.xkcd.com/comics/collatz_conjecture.png}
#' \url{http://en.wikipedia.org/wiki/Collatz_conjecture}
#' \url{https://oeis.org/A006877}
#' 
#' @examples
#' collatz(19)
#' collatz(1161)
#' collatz(1618, stoptime = TRUE)
#' collatz(5005, stoptime = TRUE)
#' 
#' @export

collatz <- function(n, stoptime = FALSE) {
  
  f <- function(n) {
    iter <- 1
    zzz <- n
    while (n > 1) {
      n <- (n / 2) * (n %% 2 == 0) + (3 * n + 1) * (n %% 2 == 1)
      iter <- iter + 1
      zzz <- c(zzz, n)
    }
    list(zzz = zzz,
         iter = iter,
         max = max(zzz),
         nth = which.max(zzz))
  }
  
  if (stoptime) {
    res <- sapply(1:n, function(x) f(x)$iter)
    cat('\n Max time:', max(res),
        '\n  Element:', which.max(res))
    
    maxv <- c(1, sapply(1:n, function(x) if (res[x] > max(res[1:(x - 1)])) x))
    message('\n\nOEIS sequence A006877: \nNumbers with a total stopping time',
            ' longer than any smaller starting value\n', 
            paste(unlist(maxv), collapse = ', '))
    
    logn <- ifelse(n > 5000, 'x', '')
    plot(1:n, res, las = 1, type = 'p', bty = 'l', log = logn,
         xlab = 'starting value', ylab = 'time', 
         main = paste0('first ', n, ' stopping times'), 
         cex.main = .8, cex.lab = .8)
  } else {
    res <- f(n)
    cat('\n   Iterations:', res$iter, 
        '\nMaximum value:', res$max,
        '\nNth iteration:', res$nth)
    plot(res$zzz, type = 'l', las = 1, bty = 'l',
         xlab = 'iterations', ylab = '',
         main = 'value per iteration', cex.main = .8, cex.lab = .8)
  }
}

#' Trace path
#' 
#' @param lens length, number of points
#' @param turn turns at each value along \code{lens}
#' 
#' @examples
#' trace_path(lens = seq(0, 1,  length.out = 200),
#'            turn = rep(pi/2 * (-1 + 1/200), 200))
#' trace_path(lens = seq(1, 10, length.out = 1000),
#'            turn = rep(2 * pi / 10, 1000))
#' trace_path(lens = seq(0, 1,  length.out = 500),
#'            turn = seq(0, pi, length.out = 500))
#' trace_path(lens = seq(0, 1,  length.out = 600) * c(1, -1),
#'            turn = seq(0, 8*pi, length.out = 600) * seq(-1, 1, length.out = 200))
#' trace_path(lens = seq(-1, 1,  length.out = 200),
#'            turn = rep(pi / 1 * (-1 + 1/200), 200))
#' trace_path(lens = seq(-1, 1,  length.out = 500),
#'            turn = rep(pi / 1 * (-1 + 1/200), 500))
#' trace_path(lens = seq(-1, 1,  length.out = 1000),
#'            turn = rep(pi / 1 * (-1 + 1/500), 1000))
#' 
#' @export

trace_path <- function(lens, turn) {
  op <- par(no.readonly = TRUE)
  on.exit(par(op))
  facing <- pi / 2 + cumsum(turn)
  move <- lens * exp(1i * facing)
  position <- cumsum(move)
  x <- c(0, Re(position))
  y <- c(0, Im(position))
  plot.new()
  par(mar = c(0, 0, 0, 0))
  plot.window(range(x), range(y))
  lines(x, y)
}

#' Bubble sort
#' 
#' The bubble sort algorithm iteratively sorts pairs of numbers by swapping 
#' each pair if unsorted and repeating until all numbers are properly sorted.
#' 
#' @param vec a vector of unsorted integers
#' 
#' @references
#' Modified from 
#' \url{http://www.numbertheory.nl/2013/05/10/bubble-sort-implemented-in-pure-r/}
#' 
#' @examples
#' \dontrun{
#' bubble_sort(round(runif(100, 0, 100)))
#' }
#' @export

bubble_sort <- function(vec) {
  swap_pass <- function(vec) {
    for (i in seq(1, length(vec) - 1)) {
      vec[i:(i + 1)] <- swap_if_larger(vec[i:(i + 1)])
    }
    return(vec)
  }
  swap_if_larger <- function(pair) 
    ifelse (c(larger(pair), larger(pair)), rev(pair), pair)
  larger <- function(pair)
    ifelse (pair[1] > pair[2], TRUE, FALSE)
  f <- function(x) sample(1:length(x), 1)
  
  new_vec <- swap_pass(vec)
  plot.new()
  par(xpd = NA, mar = c(0,0,0,0))
  plot.window(xlim = range(new_vec), ylim = range(new_vec))
  points(1:length(new_vec), new_vec, pch = 19, cex = .5, col = f(colors()))
  text(x = f(new_vec), y = f(new_vec), labels = '!! bubble sort !!', 
       srt = f(1:360), col = f(colors()), font = 2)
  Sys.sleep(.1)
  if (isTRUE(all.equal(vec, new_vec))) { 
    return(new_vec) 
  } else {
    return(bubble_sort(new_vec))
  }
}

#' Fibonacci's sequence
#' 
#' Calculates the nth number of Fibonacci's sequence.
#' 
#' @param x a positive integer
#' 
#' @examples
#' fibonacci(20)
#' sapply(1:20, fibonacci)
#' 
#' @export

fibonacci <- local({
  memo <- c(1, 1, rep(NA, 100))
  f <- function(x) {
    if(x == 0) 
      return(0)
    if(x < 0) 
      return(NA)
    if(x > length(memo))
      stop('\'x\' is too big for implementation')
    if(!is.na(memo[x])) 
      return(memo[x])
    ans <- f(x - 2) + f(x - 1)
    memo[x] <<- ans
    ans
  }
})

#' Golden ratio
#' 
#' Plots the golden ratio.
#' 
#' @param theta sequence of angles
#' 
#' @examples
#' golden()
#' 
#' @export

golden <- function(theta) {
  op <- par(no.readonly = TRUE)
  on.exit(par(op))
  
  f <- function(x) 
    ifelse(x == 90, 1, exp(2 * pi / tan(x * 2 * pi / 360)))
  f1 <- function(x)
    ifelse(x == 1, 90, 360 * atan(2 * pi / log(x)) / 2 / pi)
  
  if (missing(theta))
    theta <- seq(-100, -9.25, by = .01)
  r <- f(60) ** (theta / 2 / pi)
  x <- r * cos(theta)
  y <- r * sin(theta)
  
  par(ann = FALSE, mar = c(0,0,0,0), bg = 'lightgoldenrod')
  plot(x, y, type = 'l', axes = FALSE)
}

#' @export
ch <- function(who) {# http://www.stolaf.edu/people/olaf/cs125/
  require(ggplot2)
  require(grid)
  theme_nothing <- function(base_size = 12, base_family = 'Helvetica') {
    theme_bw(base_size = base_size, base_family = base_family) %+replace%
      theme(rect = element_blank(),
            line = element_blank(),
            text = element_blank(),
            axis.ticks.margin = unit(0, 'lines'))
  }
  f <- function(vecx, vecy) {
    vecx <- ifelse(vecx > 100, NA, vecx)
    vecx <- ifelse(vecx < 0, NA, vecx)
    vecy <- ifelse(vecy > 100, NA, vecy)
    vecy <- ifelse(vecy < 0, NA, vecy)
    qplot(x, y, data = data.frame(x = vecx, y = vecy),
          # color = I('black'), group = 1, 
          geom = 'path') + theme_nothing() +
      coord_fixed(xlim = c(0, 100), ylim = c(0, 100))
  }
  if (missing(who))
    who <- ifelse(rnorm(1) > 0, 'calvin', 'hobbes')
  switch(who, 
         calvin = f(p0x, p0y),
         hobbes = f(p1x, p1y))
}

p0x <- c(57.70922, 59.4645, 61.855355, 62.439675, 62.676785, 61.32615, 
         57.86059, 54.225475, 49.672715, 46.189625, 43.393285, 39.58617, 
         35.42843, 33.99303, 38.126825, 41.166445, 41.965535, 39.932095, 
         43.35692, 47.284685, 51.583935, 54.274095, 57.281765, 1e+10, 
         50.932625, 49.641845, 47.864835, 46.148745, 44.958615, 44.93982, 
         47.035715, 48.197725, 50.141045, 51.936855, 54.43188, 56.889295, 
         58.70459, 60.956455, 60.882385, 59.76205, 58.47435, 57.17621, 
         55.609975, 54.06919, 52.55564, 51.517555, 1e+10, 48.02837, 49.10402, 
         51.19767, 52.93221, 52.566445, 51.179025, 49.613835, 48.17596, 
         1e+10, 57.54787, 59.64993, 60.754195, 60.796455, 59.69044, 57.099335, 
         57.874645, 1e+10, 54.643615, 55.076205, 55.37596, 54.53605, 53.7139, 
         53.92304, 1e+10, 58.83865, 60.09146, 59.2006, 57.978515, 57.908065, 
         58.154585, 58.62352, 1e+10, 37.379435, 34.79652, 32.37023, 32.110295, 
         28.154835, 30.72238, 33.61206, 33.05807, 34.17524, 35.05242, 
         36.47259, 37.072385, 39.302705, 40.454975, 40.99488, 43.202745, 
         45.68864, 48.777865, 48.828805, 51.22414, 54.646905, 59.341745, 
         59.38819, 56.67973, 59.51196, 61.13823, 56.729345, 52.81808, 
         48.64592, 43.692385, 39.52085, 38.902745, 41.159415, 38.016475, 
         1e+10, 64.163115, 67.070595, 69.76255, 71.753805, 71.852765, 
         74.0471, 76.587605, 74.312635, 76.096485, 77.705095, 75.435325, 
         72.775735, 72.58854, 71.0046, 69.19247, 65.70769, 64.27807, 1e+10, 
         59.645395, 61.676955, 64.59614, 63.572565, 63.89454, 61.283545, 
         58.50432, 56.967465, 57.37535, 58.563575, 59.645395, 59.645395, 
         1e+10, 48.189715, 48.34913, 48.3477, 47.66949, 46.404415, 43.043935, 
         40.56702, 39.736085, 39.26703, 38.37329, 38.616555, 40.707225, 
         43.35805, 45.647445, 46.01632, 47.43043, 48.111515, 1e+10, 37.86347, 
         37.1557, 35.523825, 32.859245, 30.92953, 30.004795, 28.73858, 
         28.834355, 27.712455, 25.729285, 25.190665, 26.25573, 26.52358, 
         24.914185, 24.618305, 26.37051, 28.333145, 30.33056, 30.765885, 
         32.59268, 32.44147, 33.327315, 36.098745, 37.88492, 37.848675, 
         1e+10, 49.1578, 51.227235, 53.68774, 55.80434, 57.068285, 57.841735, 
         59.576685, 61.50098, 63.197105, 62.970895, 60.349365, 57.03622, 
         54.02551, 51.75974, 51.55779, 50.289195, 49.398245, 48.39467, 
         49.38869, 49.1578, 1e+10, 51.57802, 50.276245, 54.53378, 57.900055, 
         62.346805, 64.750025, 61.82035, 56.95587, 52.53592, 1e+10, 61.258865, 
         60.04586, 59.57761, 60.79679, 61.988745, 62.73632, 63.397915, 
         62.84513, 61.951585, 61.410195, 1e+10, 55.77305, 53.852085, 49.95205, 
         49.439725, 52.544815, 55.795695, 56.57979, 1e+10, 64.485815, 
         65.97349, 68.14925, 69.3949, 67.97628, 65.26494, 62.45204, 61.60755, 
         62.64628, 64.04949, 1e+10, 58.031915, 59.86315, 60.54103, 57.30073, 
         51.027025, 46.74631, 46.48532, 48.34376, 49.043065, 53.40951, 
         56.19922, 57.835345)
p0y <- c(76.19327, 73.420405, 69.09677, 64.04871, 58.990585, 56.350625, 
         53.988835, 50.815225, 49.27107, 51.647705, 54.040205, 54.370895, 
         54.207805, 58.092295, 59.17047, 61.32211, 65.741325, 70.254715, 
         72.468515, 75.192595, 76.97623, 73.672255, 75.295975, 1e+10, 
         52.152485, 52.582745, 53.2503, 54.38204, 55.220855, 56.3477, 
         57.305775, 57.56003, 58.255965, 58.674535, 58.843365, 59.02457, 
         59.50198, 59.897165, 58.821515, 57.53869, 56.411955, 55.276085, 
         54.32981, 53.428905, 52.48154, 52.152485, 1e+10, 55.54078, 56.293735, 
         56.72438, 55.742445, 53.821905, 53.242895, 53.25805, 55.171805, 
         1e+10, 64.414895, 65.315775, 64.553955, 62.2642, 61.61384, 60.143945, 
         61.45822, 1e+10, 68.44858, 66.42983, 65.03936, 64.253545, 65.96737, 
         67.367715, 1e+10, 69.09397, 67.21476, 65.61498, 66.2836, 67.44527, 
         69.06819, 69.09397, 1e+10, 60.542555, 61.789015, 63.063655, 65.683735, 
         68.85991, 67.984475, 65.80278, 70.297015, 75.41966, 75.39376, 
         71.89421, 76.416375, 80.724075, 80.69502, 76.938, 78.73766, 83.206785, 
         85.50399, 80.402935, 78.88114, 81.24392, 83.201965, 79.836655, 
         77.85673, 78.40765, 76.30181, 76.71706, 75.776855, 76.81335, 
         74.99902, 72.37979, 67.28877, 62.916835, 61.244575, 1e+10, 54.411345, 
         55.525605, 57.883355, 59.442745, 56.93877, 57.6502, 56.99223, 
         55.53901, 55.21305, 53.683165, 52.756455, 52.623825, 50.208455, 
         51.931055, 53.42638, 53.131475, 54.062215, 1e+10, 55.21808, 55.93119, 
         55.49247, 52.078755, 48.8689, 47.29139, 47.00142, 49.492525, 
         51.7429, 54.459635, 55.21808, 55.21808, 1e+10, 48.60283, 48.10993, 
         46.698035, 45.447365, 44.849885, 44.84472, 45.220755, 46.42226, 
         48.80798, 50.950645, 52.55713, 51.85965, 51.121485, 51.10047, 
         49.979265, 48.981545, 48.645855, 1e+10, 49.570925, 49.70314, 
         50.59127, 50.65531, 49.32855, 47.203755, 47.0275, 48.41649, 49.135925, 
         48.84325, 50.110345, 51.380625, 51.596115, 51.629565, 53.649815, 
         54.327125, 54.15311, 53.93848, 55.810215, 56.40999, 54.08692, 
         52.143855, 51.634945, 50.59468, 49.718535, 1e+10, 48.76419, 48.943425, 
         50.353905, 50.68899, 48.74315, 46.219275, 44.257305, 40.636505, 
         37.666885, 34.774255, 33.93397, 33.432385, 33.04079, 33.986155, 
         36.44743, 39.01956, 41.813575, 44.87661, 47.789085, 48.76419, 
         1e+10, 32.952135, 29.9562, 29.57284, 31.021015, 30.99282, 33.39188, 
         34.724805, 31.710035, 32.258185, 1e+10, 28.59575, 29.31805, 30.412445, 
         30.294175, 30.36333, 30.579405, 30.34716, 29.896805, 29.30922, 
         28.714225, 1e+10, 28.4344, 26.40246, 26.356665, 29.71512, 27.984245, 
         28.44441, 28.59575, 1e+10, 30.53192, 31.691885, 31.73294, 30.229105, 
         28.027915, 25.89456, 25.84583, 27.37995, 28.731095, 30.026725, 
         1e+10, 29.241135, 29.132825, 26.54089, 24.62729, 24.21227, 25.46057, 
         28.235435, 29.405455, 26.7696, 25.38458, 27.318245, 28.71358)
p1x <- c(14.734696, 13.606188, 13.770634, 11.87416, 13.930046, 13.919376, 
         15.605866, 19.024016, 20.689294, 18.409084, 20.88926, 23.855424, 
         24.974436, 28.347778, 29.988964, 29.557358, 32.137978, 30.328302, 
         31.456664, 29.394938, 31.16355, 29.290602, 29.185754, 27.056558, 
         27.210106, 25.819352, 25.119672, 22.502478, 21.417272, 18.64345, 
         15.249888, 14.340166, 15.365596, 1e+10, 31.163644, 29.860732, 
         27.475216, 25.619176, 22.834964, 20.312192, 20.981136, 22.623054, 
         21.79807, 23.786844, 24.569322, 25.817206, 27.194404, 29.441956, 
         31.448764, 33.757936, 33.474312, 31.86629, 31.253532, 1e+10, 
         31.89382, 33.431772, 33.930854, 35.418494, 38.954696, 43.14667, 
         45.582948, 44.067614, 42.289896, 40.406552, 38.400594, 35.18364, 
         32.405128, 30.385814, 31.297056, 33.055628, 35.188874, 33.395728, 
         32.15518, 1e+10, 21.671366, 22.042438, 21.093148, 20.273778, 
         18.884828, 17.62883, 15.65423, 13.822146, 11.679078, 10.120546, 
         11.223438, 13.487668, 15.938576, 18.113676, 19.934296, 21.20836, 
         1e+10, 19.937194, 19.059036, 17.489212, 15.644472, 14.368462, 
         13.632834, 14.229518, 15.591714, 18.002852, 19.93878, 19.980518, 
         1e+10, 19.389562, 18.341502, 16.910224, 15.258534, 14.467122, 
         14.424168, 14.64599, 14.782476, 16.042866, 17.756048, 19.032734, 
         1e+10, 18.841932, 18.890916, 18.543132, 18.180756, 17.908876, 
         17.802318, 17.675856, 17.8729, 18.175352, 18.439706, 18.660212, 
         18.826404, 18.841932, 18.841932, 1e+10, 16.651406, 16.286318, 
         15.499498, 15.804244, 16.426322, 16.829324, 1e+10, 18.476846, 
         17.807518, 16.842034, 16.06022, 16.83395, 17.97202, 1e+10, 24.044434, 
         24.381808, 23.845454, 22.679114, 23.04628, 22.062618, 20.554946, 
         20.274406, 20.9371, 22.04953, 23.151788, 23.893966, 1e+10, 20.849914, 
         22.007776, 22.362178, 24.38433, 25.37854, 27.455322, 29.163812, 
         27.725808, 26.465954, 24.459202, 22.164732, 19.895882, 17.36941, 
         15.809982, 15.823742, 14.380446, 13.14111, 14.457004, 12.323512, 
         13.285304, 13.417716, 13.731216, 14.465756, 14.436796, 14.377786, 
         15.384376, 17.425726, 19.931482, 20.614564, 1e+10, 28.881846, 
         29.612054, 30.3909, 29.944564, 29.109982, 26.817168, 25.039884, 
         26.232264, 26.757976, 27.739838, 28.578596, 1e+10, 27.969126, 
         28.301046, 28.633076, 28.934506, 28.42449, 27.77035, 26.902928, 
         26.764398, 27.332292, 27.866704, 1e+10, 16.286318, 16.955646, 
         17.775656, 18.989308, 19.085324, 18.326836, 17.333608, 16.480174, 
         16.031874, 16.164622, 1e+10, 30.9811, 34.434854, 39.531978, 46.064566, 
         53.023676, 58.524536, 65.734364, 71.673904, 73.39481, 78.561124, 
         78.943406, 72.294278, 66.523264, 60.901048, 55.088738, 50.04076, 
         46.25188, 42.887808, 39.663626, 34.752484, 29.905842, 33.681414, 
         29.809774, 30.978386, 30.721718, 1e+10, 26.23496, 27.6431, 29.702518, 
         31.282718, 32.27513, 31.29382, 31.086492, 29.898556, 29.162964, 
         28.91294, 27.659108, 26.49691, 1e+10, 43.394086, 45.163886, 49.573262, 
         53.338956, 56.901098, 61.172946, 64.712088, 68.38121, 66.6359, 
         63.265016, 60.248032, 55.718988, 51.608458, 47.810472, 44.840482, 
         42.93239, 1e+10, 79.720318, 81.367326, 83.93054, 86.32213, 85.55612, 
         83.674626, 78.4785, 74.021148, 71.860466, 69.105574, 68.708166, 
         65.96084, 64.757492, 66.385316, 69.791754, 74.871716, 78.487948, 
         81.107466, 81.380404, 79.565428, 79.679812, 1e+10, 71.505842, 
         70.59985, 69.484562, 68.91738, 69.22434, 70.001784, 71.128576, 
         72.36427, 73.24974, 73.753404, 74.014316, 73.245476, 71.92022, 
         1e+10, 75.065448, 75.432494, 76.367766, 77.364416, 78.294156, 
         78.674704, 78.834104, 78.228388, 77.709624, 76.787842, 75.800824, 
         74.49472, 73.602258, 73.653196, 74.07498, 74.450052, 74.811186, 
         75.0323, 1e+10, 66.394616, 66.442818, 66.671692, 66.349776, 66.660286, 
         68.307032, 69.85792, 71.267444, 71.9207, 73.054996, 73.559654, 
         74.007592, 74.444602, 74.449706, 73.22038, 70.923918, 68.31779, 
         66.803884, 1e+10, 70.866938, 71.657962, 72.563626, 72.65815, 
         71.851628, 71.111258, 71.195612, 1e+10, 70.228034, 70.047126, 
         69.421386, 68.410348, 68.207268, 67.978574, 68.20188, 69.372566, 
         70.19551, 70.390452, 1e+10, 69.224044, 68.880006, 67.796518, 
         67.255464, 67.584784, 68.177008, 69.075126, 69.254468, 1e+10, 
         74.882904, 75.783154, 76.751914, 76.522802, 75.6249, 74.658074, 
         74.67711, 1e+10, 75.065448, 75.968598, 75.166294, 75.065448, 
         1e+10, 70.228036, 70.897362, 72.340298, 72.764794, 72.72945, 
         71.71691, 71.048314, 70.52009)
p1y <- c(53.71474, 54.45644, 53.57493, 53.090968, 52.34287, 51.457384, 
         53.411998, 53.113656, 49.906816, 48.381412, 48.44082, 47.81587, 
         50.87807, 51.054948, 52.743988, 54.025088, 54.306678, 55.787452, 
         57.284386, 57.604948, 60.107088, 60.25997, 58.912814, 60.169426, 
         57.990318, 59.852354, 57.009124, 56.089508, 59.128704, 62.410314, 
         60.734088, 57.175156, 54.34906, 10000000025, 45.774078, 45.856108, 
         46.52716, 47.10758, 46.335232, 44.474996, 42.309702, 43.524938, 
         41.40441, 40.54773, 40.543822, 39.608564, 40.61561, 41.347818, 
         42.520604, 42.221234, 44.312476, 45.17914, 45.70688, 10000000025, 
         46.047894, 45.749234, 43.536692, 42.556412, 42.170204, 42.17946, 
         42.710394, 44.23659, 46.71476, 49.749618, 51.580322, 52.748126, 
         52.74068, 51.518322, 49.149384, 47.49742, 46.34168, 45.94899, 
         46.233262, 10000000025, 47.416974, 46.552738, 45.783024, 44.526378, 
         44.660912, 44.78728, 44.168708, 44.761124, 45.19216, 46.389944, 
         48.294354, 49.410296, 48.280332, 47.692634, 48.041312, 47.376466, 
         10000000025, 50.52022, 51.485522, 52.563358, 52.802108, 52.101162, 
         50.937326, 49.834306, 48.71152, 48.179342, 49.383088, 50.374276, 
         10000000025, 50.611492, 51.309328, 52.090646, 52.0408, 51.280672, 
         50.428126, 49.63635, 50.447044, 50.997872, 50.83033, 50.578886, 
         10000000025, 53.988556, 54.167512, 54.895828, 55.60909, 55.964084, 
         55.55006, 54.98919, 54.270728, 53.762356, 53.502674, 53.892836, 
         53.984316, 53.988556, 53.988556, 10000000025, 54.810002, 55.418482, 
         55.20477, 54.241812, 53.872918, 54.489752, 10000000025, 52.619476, 
         53.167108, 53.62185, 53.206946, 52.984564, 52.770924, 10000000025, 
         52.254388, 53.077776, 53.58425, 52.8731, 51.527012, 50.197064, 
         49.117624, 48.549712, 48.476102, 49.623272, 50.585706, 51.772434, 
         10000000025, 61.107764, 60.445412, 58.221718, 57.365644, 59.40386, 
         60.213806, 61.256296, 62.784472, 64.881604, 66.163578, 66.57798, 
         65.848422, 65.326334, 63.908892, 63.219038, 63.433252, 62.38383, 
         61.030948, 60.607058, 59.846814, 58.799792, 56.801662, 54.706254, 
         55.807168, 59.08794, 61.839752, 62.858356, 62.858364, 61.36004, 
         10000000025, 62.933204, 63.669966, 65.256906, 66.70824, 67.550594, 
         67.892196, 66.54633, 65.671272, 64.472644, 63.670678, 63.040896, 
         10000000025, 64.028466, 63.906356, 64.506716, 65.136066, 65.484122, 
         65.804042, 65.45059, 64.823256, 64.321194, 64.105634, 10000000025, 
         64.758644, 65.18458, 65.721112, 66.03645, 66.523234, 67.06981, 
         67.135576, 66.504122, 65.85949, 64.941188, 10000000025, 59.647418, 
         60.193398, 59.42204, 59.274292, 84.857278, 86.732034, 87.364696, 
         83.937598, 86.565726, 82.0617, 76.738898, 74.620848, 75.228478, 
         74.15981, 73.086788, 73.001718, 48.03655, 46.235374, 51.115422, 
         53.807804, 50.815952, 54.236528, 56.84064, 58.721616, 59.407108, 
         10000000025, 50.337678, 50.104924, 48.668246, 47.68023, 47.48542, 
         47.92725, 49.211548, 51.18539, 52.792726, 51.663386, 50.726212, 
         50.502136, 10000000025, 46.412982, 46.429626, 46.962264, 72.146288, 
         72.042092, 72.863138, 73.66461, 74.75135, 74.706822, 74.864094, 
         73.31497, 73.169988, 72.960332, 47.583034, 47.822128, 47.275598, 
         10000000025, 80.631452, 80.771914, 80.039866, 77.320254, 74.450726, 
         72.879212, 71.826066, 71.657382, 69.925554, 69.660608, 66.895912, 
         67.5899, 69.802536, 71.940366, 72.942878, 73.839164, 74.568116, 
         75.739584, 78.122492, 79.298708, 80.439124, 10000000025, 69.039914, 
         68.812406, 68.506546, 67.597868, 66.75767, 66.11307, 65.74865, 
         65.721312, 66.125698, 66.887386, 67.959692, 68.88415, 69.039914, 
         10000000025, 85.92522, 86.120216, 86.101876, 86.670826, 87.35864, 
         88.515802, 89.693462, 90.678572, 91.804192, 92.343754, 92.61888, 
         92.666694, 92.466866, 91.65536, 90.276788, 88.80054, 87.058094, 
         86.09061, 10000000025, 87.203028, 87.905448, 90.190188, 92.390646, 
         93.881326, 94.440226, 94.962368, 94.660876, 93.423008, 91.821256, 
         90.24838, 88.360428, 85.342944, 83.128894, 83.294068, 85.010104, 
         86.279802, 87.05962, 10000000025, 88.480836, 88.298292, 89.14355, 
         90.237814, 90.762636, 90.034128, 88.56157, 10000000025, 91.49281, 
         92.168524, 92.912162, 92.979504, 92.350064, 91.54404, 90.614968, 
         90.115198, 90.392862, 91.212374, 10000000025, 88.298292, 89.123982, 
         89.56369, 88.898596, 87.973388, 87.50554, 87.552638, 88.085324, 
         10000000025, 91.218994, 91.401538, 90.738968, 89.752652, 89.556664, 
         89.903832, 90.848564, 10000000025, 88.66338, 88.211806, 87.780914, 
         88.35914, 10000000025, 86.016494, 86.503278, 86.523714, 85.962934, 
         84.588444, 84.727278, 85.230296, 85.72444)

#' Happy numbers
#' 
#' For any positive integer, \code{N}, if the sum of the squares of its
#' digits equals one (or by recursion), then \code{N} is happy \code{:\}}!
#' Otherwise, \code{N} is sad \code{:c}.
#' 
#' @param x a positive integer (any non-digit characters will be ignored)
#' 
#' @examples
#' is.happy(20)
#' is.happy(19)
#' 
#' @export

is.happy <- function(x) {
  sad <- sample(c('>:[',':-(',':(',':-c',':c',':-<',':C',':{',':-[',':[',':{'), 1)
  hap <- sample(c(':-)',':)',':o)',':]',':3',':)',':}','=]','8)','=)',':}',':^)',':)'), 1)
  x <- gsub('\\D', '', x)
  ok <- (function(x) {
    xx <- as.numeric(strsplit(as.character(x), '')[[1]]) ** 2
    tryCatch(if ((xx <- sum(xx)) == 1) sprintf('happy! %s', hap) else Recall(xx), 
             error = function(e) sprintf('sad %s', sad))
  })(x)
  sprintf('%s is %s', x, ok)
}

